generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model academic_consultations {
  id         String    @id
  date       DateTime
  uraian     String
  keterangan String
  paraf      Boolean   @default(false)
  student_id String
  advisor_id String
  created_at DateTime  @default(now())
  updated_at DateTime
  lecturers  lecturers @relation(fields: [advisor_id], references: [id])
  students   students  @relation(fields: [student_id], references: [id])
}

model academic_events {
  id          String      @id
  title       String
  description String?
  start_date  DateTime
  end_date    DateTime
  location    String?
  type        EventType
  exam_type   ExamType?
  status      EventStatus @default(confirmed)
  student_id  String?
  course_id   String?
  lecturer_id String?
  created_at  DateTime    @default(now())
  updated_at  DateTime
  is_global   Boolean     @default(false)
  prodi_id    String?
  courses     courses?    @relation(fields: [course_id], references: [id])
  lecturers   lecturers?  @relation(fields: [lecturer_id], references: [id])
  prodi       prodi?      @relation(fields: [prodi_id], references: [kode])
  students    students?   @relation(fields: [student_id], references: [id])
}

model accounts {
  id                  String  @id
  user_id             String
  type                String
  provider            String
  provider_account_id String
  refresh_token       String?
  access_token        String?
  expires_at          Int?
  token_type          String?
  scope               String?
  id_token            String?
  session_state       String?
  users               users   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([provider, provider_account_id])
}

model audit_logs {
  id         String   @id
  user_id    String
  action     String
  resource   String
  details    Json?
  ip_address String?
  user_agent String?
  created_at DateTime @default(now())
  users      users    @relation(fields: [user_id], references: [id])
}

model book_borrowings {
  id          String          @id
  borrow_date DateTime        @default(now())
  due_date    DateTime
  return_date DateTime?
  status      BorrowingStatus @default(active)
  notes       String?
  fine        Decimal?        @db.Decimal(8, 2)
  book_id     String
  student_id  String
  books       books           @relation(fields: [book_id], references: [id])
  students    students        @relation(fields: [student_id], references: [id])
}

model book_categories {
  id          String  @id
  code        String  @unique
  name        String
  description String?
  is_active   Boolean @default(true)
  books       books[]
}

model books {
  id                 String            @id
  title              String
  author             String
  publisher          String
  publication_year   Int
  isbn               String            @unique
  category_id        String
  cover_image        String?
  description        String?
  page_count         Int?
  location           String
  status             BookStatus        @default(available)
  added_date         DateTime          @default(now())
  last_borrowed_date DateTime?
  borrow_count       Int               @default(0)
  book_borrowings    book_borrowings[]
  book_categories    book_categories   @relation(fields: [category_id], references: [id])
}

model budget_allocations {
  id          String  @id
  budget_id   String
  department  String?
  amount      Decimal @db.Decimal(12, 2)
  description String?
  prodi_id    String?
  budgets     budgets @relation(fields: [budget_id], references: [id], onDelete: Cascade)
  prodi       prodi?  @relation(fields: [prodi_id], references: [kode])
}

model budgets {
  id                 String               @id
  name               String
  description        String?
  total_amount       Decimal              @db.Decimal(15, 2)
  used_amount        Decimal              @default(0) @db.Decimal(15, 2)
  category           String
  department         String?
  fiscal_year        String
  status             BudgetStatus         @default(active)
  created_at         DateTime             @default(now())
  updated_at         DateTime
  prodi_id           String?
  budget_allocations budget_allocations[]
  prodi              prodi?               @relation(fields: [prodi_id], references: [kode])
  expenses           expenses[]
}

model companies {
  id               String             @id
  name             String
  address          String
  city             String
  province         String?
  postal_code      String?
  contact_person   String
  contact_position String?
  contact_email    String?
  contact_phone    String
  website          String?
  logo             String?
  industry         String
  description      String?
  is_active        Boolean            @default(true)
  kkp_applications kkp_applications[]
  kkp_locations    kkp_locations[]
}

model course_schedules {
  id            String  @id
  course_id     String
  day           String
  start_time    String
  end_time      String
  room          String
  building      String?
  semester      String
  academic_year String
  courses       courses @relation(fields: [course_id], references: [id], onDelete: Cascade)
}

model courses {
  id                 String               @id
  code               String               @unique
  name               String
  description        String?
  credits            Int
  semester           Int
  department         String?
  is_active          Boolean              @default(true)
  lecturer_id        String?
  prodi_id           String?
  academic_events    academic_events[]
  course_schedules   course_schedules[]
  lecturers          lecturers?           @relation(fields: [lecturer_id], references: [id])
  prodi              prodi?               @relation(fields: [prodi_id], references: [kode])
  curriculum_courses curriculum_courses[]
  grades             grades[]
}

model exam_applications {
  id                                                    String            @id
  title                                                 String
  type                                                  ExamType
  status                                                ExamStatus        @default(pending)
  abstract                                              String?
  submission_date                                       DateTime          @default(now())
  scheduled_date                                        DateTime?
  completion_date                                       DateTime?
  location                                              String?
  student_id                                            String
  advisor_1_id                                          String?
  advisor_2_id                                          String?
  created_at                                            DateTime          @default(now())
  updated_at                                            DateTime
  lecturers_exam_applications_advisor_1_id_to_lecturers lecturers?        @relation("exam_applications_advisor_1_id_to_lecturers", fields: [advisor_1_id], references: [id])
  lecturers_exam_applications_advisor_2_id_to_lecturers lecturers?        @relation("exam_applications_advisor_2_id_to_lecturers", fields: [advisor_2_id], references: [id])
  students                                              students          @relation(fields: [student_id], references: [id])
  exam_committees                                       exam_committees[]
  exam_documents                                        exam_documents[]
}

model exam_committees {
  id                String            @id
  exam_id           String
  lecturer_id       String
  role              String
  exam_applications exam_applications @relation(fields: [exam_id], references: [id], onDelete: Cascade)
  lecturers         lecturers         @relation(fields: [lecturer_id], references: [id])

  @@unique([exam_id, lecturer_id])
}

model exam_documents {
  id                String            @id
  name              String
  type              ExamDocumentType
  status            DocumentStatus    @default(pending)
  upload_date       DateTime          @default(now())
  verification_date DateTime?
  file_url          String
  file_size         Int?
  notes             String?
  exam_id           String
  exam_applications exam_applications @relation(fields: [exam_id], references: [id], onDelete: Cascade)
}

model exam_requirements {
  id                        String                      @id
  exam_type                 ExamType
  title                     String
  description               String?
  required                  Boolean                     @default(true)
  order                     Int                         @default(0)
  created_at                DateTime                    @default(now())
  updated_at                DateTime
  is_global                 Boolean                     @default(false)
  prodi_id                  String?
  prodi                     prodi?                      @relation(fields: [prodi_id], references: [kode])
  exam_student_requirements exam_student_requirements[]
}

model exam_student_requirements {
  id                String            @id
  student_id        String
  requirement_id    String
  completed         Boolean           @default(false)
  completed_at      DateTime?
  file_url          String?
  file_name         String?
  file_size         Int?
  uploaded_at       DateTime?
  verified_at       DateTime?
  notes             String?
  exam_requirements exam_requirements @relation(fields: [requirement_id], references: [id], onDelete: Cascade)
  students          students          @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@unique([student_id, requirement_id])
}

model expenses {
  id           String        @id
  budget_id    String
  amount       Decimal       @db.Decimal(10, 2)
  description  String
  category     String
  expense_date DateTime
  receipt      String?
  status       ExpenseStatus @default(pending)
  approved_by  String?
  approved_at  DateTime?
  created_at   DateTime      @default(now())
  budgets      budgets       @relation(fields: [budget_id], references: [id])
}

model file_uploads {
  id            String   @id
  filename      String
  original_name String
  path          String
  size          Int
  mime_type     String
  uploaded_by   String
  category      String?
  created_at    DateTime @default(now())
}

model grades {
  id            String   @id
  score         Float
  letter_grade  String
  semester      String
  academic_year String
  student_id    String
  course_id     String
  created_at    DateTime @default(now())
  courses       courses  @relation(fields: [course_id], references: [id])
  students      students @relation(fields: [student_id], references: [id])

  @@unique([student_id, course_id, semester, academic_year])
}

model kkp_applications {
  id                 String          @id
  application_number String          @unique
  title              String
  description        String
  submission_date    DateTime        @default(now())
  start_date         DateTime
  end_date           DateTime
  status             KkpStatus       @default(pending)
  notes              String?
  student_id         String
  group_members      Json?
  supervisor_id      String?
  company_id         String
  created_at         DateTime        @default(now())
  updated_at         DateTime
  companies          companies       @relation(fields: [company_id], references: [id])
  students           students        @relation(fields: [student_id], references: [id])
  lecturers          lecturers?      @relation(fields: [supervisor_id], references: [id])
  kkp_approvals      kkp_approvals[]
  kkp_documents      kkp_documents[]
}

model kkp_approvals {
  id               String           @id
  application_id   String
  approver_role    String
  approver_id      String?
  status           ApprovalStatus
  comments         String?
  approved_at      DateTime?
  kkp_applications kkp_applications @relation(fields: [application_id], references: [id], onDelete: Cascade)
}

model kkp_documents {
  id               String            @id
  name             String
  type             KkpDocumentType
  url              String
  upload_date      DateTime          @default(now())
  status           DocumentStatus    @default(pending)
  notes            String?
  file_size        Int?
  mime_type        String?
  application_id   String?
  location_id      String?
  kkp_applications kkp_applications? @relation(fields: [application_id], references: [id], onDelete: Cascade)
  kkp_locations    kkp_locations?    @relation(fields: [location_id], references: [id], onDelete: Cascade)
}

model kkp_locations {
  id                String              @id
  name              String
  address           String
  city              String
  province          String?
  industry          String
  positions         Json
  quota             Int                 @default(0)
  remaining         Int                 @default(0)
  status            String              @default("available")
  distance          Float?
  contact_person    String?
  contact_email     String?
  contact_phone     String?
  description       String?
  is_active         Boolean             @default(true)
  company_id        String?
  created_by_id     String
  created_at        DateTime            @default(now())
  updated_at        DateTime
  kkp_documents     kkp_documents[]
  companies         companies?          @relation(fields: [company_id], references: [id])
  students          students            @relation(fields: [created_by_id], references: [id])
  kkp_sub_locations kkp_sub_locations[]

  @@unique([name, address])
}

model kkp_requirements {
  id                 String             @id
  student_id         String
  requirement_type   KkpRequirementType
  file_name          String
  original_file_name String
  file_path          String
  file_size          Int
  mime_type          String             @default("application/pdf")
  status             DocumentStatus     @default(pending)
  notes              String?
  uploaded_at        DateTime           @default(now())
  verified_at        DateTime?
  verified_by        String?
  created_at         DateTime           @default(now())
  updated_at         DateTime
  students           students           @relation(fields: [student_id], references: [id])

  @@unique([student_id, requirement_type])
}

model kkp_sub_locations {
  id             String        @id
  name           String
  address        String
  contact_person String
  contact_email  String?
  contact_phone  String?
  location_id    String
  created_at     DateTime      @default(now())
  updated_at     DateTime
  kkp_locations  kkp_locations @relation(fields: [location_id], references: [id], onDelete: Cascade)
}

model lab_announcements {
  id            String       @id
  title         String
  content       String
  is_important  Boolean      @default(false)
  laboratory_id String
  created_at    DateTime     @default(now())
  updated_at    DateTime
  laboratories  laboratories @relation(fields: [laboratory_id], references: [id])
}

model lab_assignment_submissions {
  id                String            @id
  submitted_at      DateTime          @default(now())
  score             Float?
  feedback          String?
  file_url          String?
  student_id        String
  assignment_id     String
  registration_id   String
  created_at        DateTime          @default(now())
  updated_at        DateTime
  lab_assignments   lab_assignments   @relation(fields: [assignment_id], references: [id])
  lab_registrations lab_registrations @relation(fields: [registration_id], references: [id])
  students          students          @relation(fields: [student_id], references: [id])

  @@unique([student_id, assignment_id])
}

model lab_assignments {
  id                         String                       @id
  title                      String
  description                String
  due_date                   DateTime
  max_score                  Float                        @default(100)
  laboratory_id              String
  created_at                 DateTime                     @default(now())
  updated_at                 DateTime
  lab_assignment_submissions lab_assignment_submissions[]
  laboratories               laboratories                 @relation(fields: [laboratory_id], references: [id])
}

model lab_materials {
  id            String       @id
  title         String
  description   String?
  type          String
  file_url      String?
  external_url  String?
  laboratory_id String
  created_at    DateTime     @default(now())
  updated_at    DateTime
  laboratories  laboratories @relation(fields: [laboratory_id], references: [id])
}

model lab_registrations {
  id                         String                       @id
  status                     LabRegistrationStatus        @default(pending)
  registered_at              DateTime                     @default(now())
  completed_at               DateTime?
  progress                   Float                        @default(0)
  grade                      String?
  student_id                 String
  laboratory_id              String
  created_at                 DateTime                     @default(now())
  updated_at                 DateTime
  lab_assignment_submissions lab_assignment_submissions[]
  laboratories               laboratories                 @relation(fields: [laboratory_id], references: [id])
  students                   students                     @relation(fields: [student_id], references: [id])

  @@unique([student_id, laboratory_id])
}

model lab_sessions {
  id            String           @id
  title         String
  description   String?
  session_date  DateTime
  start_time    String
  end_time      String
  location      String?
  status        LabSessionStatus @default(scheduled)
  laboratory_id String
  created_at    DateTime         @default(now())
  updated_at    DateTime
  laboratories  laboratories     @relation(fields: [laboratory_id], references: [id])
}

model laboratories {
  id                String              @id
  code              String              @unique
  name              String
  description       String?
  image             String?
  capacity          Int
  credits           Int
  semester          String
  department        String
  location          String
  category          String
  status            LabStatus           @default(active)
  instructor_id     String?
  created_at        DateTime            @default(now())
  updated_at        DateTime
  prodi_id          String?
  lab_announcements lab_announcements[]
  lab_assignments   lab_assignments[]
  lab_materials     lab_materials[]
  lab_registrations lab_registrations[]
  lab_sessions      lab_sessions[]
  lecturers         lecturers?          @relation(fields: [instructor_id], references: [id])
  prodi             prodi?              @relation(fields: [prodi_id], references: [kode])
  laboratory_admins laboratory_admins[]
}

model lecturers {
  id                                                            String                   @id
  user_id                                                       String                   @unique
  nip                                                           String                   @unique
  department                                                    String?
  position                                                      String
  specialization                                                String?
  phone                                                         String?
  office                                                        String?
  email                                                         String?
  last_sync_at                                                  DateTime?
  is_homebase                                                   Boolean                  @default(true)
  prodi_id                                                      String?
  academic_consultations                                        academic_consultations[]
  academic_events                                               academic_events[]
  courses                                                       courses[]
  exam_applications_exam_applications_advisor_1_id_to_lecturers exam_applications[]      @relation("exam_applications_advisor_1_id_to_lecturers")
  exam_applications_exam_applications_advisor_2_id_to_lecturers exam_applications[]      @relation("exam_applications_advisor_2_id_to_lecturers")
  exam_committees                                               exam_committees[]
  kkp_applications                                              kkp_applications[]
  laboratories                                                  laboratories[]
  prodi                                                         prodi?                   @relation(fields: [prodi_id], references: [kode])
  users                                                         users                    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  rekomendasi_judul                                             rekomendasi_judul[]
  students                                                      students[]
  thesis_titles                                                 thesis_titles[]
}

model letter_attachments {
  id              String          @id
  name            String
  upload_date     DateTime        @default(now())
  url             String
  file_size       Int?
  mime_type       String?
  request_id      String
  letter_requests letter_requests @relation(fields: [request_id], references: [id], onDelete: Cascade)
}

model letter_requests {
  id                      String                    @id
  type                    String
  title                   String
  purpose                 String
  description             String
  status                  LetterStatus              @default(submitted)
  request_date            DateTime                  @default(now())
  approved_date           DateTime?
  completed_date          DateTime?
  rejected_reason         String?
  additional_info         Json?
  student_id              String
  approval_role           ApprovalRole
  approved_by             String?
  generated_letter        String?
  letter_number           String?
  created_at              DateTime                  @default(now())
  updated_at              DateTime
  assigned_to             String?
  forwarded_at            DateTime?
  forwarded_by            String?
  wd1_approved_at         DateTime?
  wd1_approved_by         String?
  wd1_notes               String?
  workflow_stage          String                    @default("initial_review")
  qr_code_url             String?
  signature               String?
  signature_data          Json?
  signed_at               DateTime?
  signed_by               String?
  verification_count      Int                       @default(0)
  letter_attachments      letter_attachments[]
  students                students                  @relation(fields: [student_id], references: [id])
  signature_verifications signature_verifications[]
  workflow_history        workflow_history[]
}

model letter_types {
  id                      String                    @id
  title                   String                    @unique
  description             String
  approval_role           ApprovalRole
  estimated_days          Int
  required_documents      String[]
  additional_fields       Json?
  is_active               Boolean                   @default(true)
  template                String?
  is_global               Boolean                   @default(false)
  prodi_id                String?
  created_at              DateTime                  @default(now())
  updated_at              DateTime                  @updatedAt
  jenis_surat_id          Int?
  scope                   String                    @default("fakultas")
  correspondence_requests correspondence_requests[]
  jenis_surat_link        jenis_surat?              @relation("LetterTypeJenisSurat", fields: [jenis_surat_id], references: [id])
  prodi                   prodi?                    @relation(fields: [prodi_id], references: [kode])
}

model correspondence_requests {
  id             String         @id
  letter_type_id String
  student_id     String
  form_data      Json
  attachments    Json?
  status         ApprovalStatus @default(pending)
  rejection_note String?
  approved_by    String?
  approved_at    DateTime?
  created_at     DateTime       @default(now())
  updated_at     DateTime       @updatedAt
  approver       users?         @relation("ApprovedBy", fields: [approved_by], references: [id])
  letter_types   letter_types   @relation(fields: [letter_type_id], references: [id])
  students       students       @relation(fields: [student_id], references: [id])
}

model workflow_history {
  id                String          @id
  letter_request_id String
  action            String
  actor_id          String
  actor_role        String
  notes             String?
  created_at        DateTime        @default(now())
  letter_requests   letter_requests @relation(fields: [letter_request_id], references: [id], onDelete: Cascade)
}

model signature_verifications {
  id                String          @id @default(cuid())
  letter_request_id String
  verified_at       DateTime        @default(now())
  ip_address        String?
  user_agent        String?
  is_valid          Boolean         @default(true)
  letter_requests   letter_requests @relation(fields: [letter_request_id], references: [id], onDelete: Cascade)

  @@index([letter_request_id])
}

model role_assignments {
  id             String   @id
  letter_type_id String
  initial_role   String
  approval_role  String
  is_active      Boolean  @default(true)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
}

model notifications {
  id         String           @id
  user_id    String
  title      String
  message    String
  type       NotificationType @default(info)
  is_read    Boolean          @default(false)
  data       Json?
  created_at DateTime         @default(now())
  read_at    DateTime?
}

model payment_items {
  id            String          @id
  name          String
  description   String?
  amount        Decimal         @db.Decimal(10, 2)
  category      PaymentCategory
  semester      String
  academic_year String
  due_date      DateTime
  is_required   Boolean         @default(true)
  is_recurring  Boolean         @default(false)
  payment_id    String?
  created_at    DateTime        @default(now())
  payments      payments?       @relation(fields: [payment_id], references: [id])
}

model payments {
  id             String          @id
  amount         Decimal         @db.Decimal(12, 2)
  description    String
  category       PaymentCategory
  status         PaymentStatus   @default(pending)
  due_date       DateTime
  paid_date      DateTime?
  semester       String
  academic_year  String
  receipt_number String?
  payment_method String?
  notes          String?
  student_id     String
  created_at     DateTime        @default(now())
  updated_at     DateTime
  payment_items  payment_items[]
  students       students        @relation(fields: [student_id], references: [id])
}

model prodi {
  nama                    String
  akreditasi              String?
  fakultas                String
  jenjang                 String
  kode                    String                    @id
  created_at              DateTime                  @default(now())
  updated_at              DateTime                  @default(now())
  academic_events         academic_events[]
  announcements           announcements[]
  budget_allocations      budget_allocations[]
  budgets                 budgets[]
  classrooms              classrooms[]
  courses                 courses[]
  curriculum              curriculum[]
  exam_requirements       exam_requirements[]
  ketentuan_surat         ketentuan_surat[]
  laboratories            laboratories[]
  laboratory_admins       laboratory_admins[]
  laboratory_certificates laboratory_certificates[]
  lecturers               lecturers[]
  letter_types            letter_types[]
  reading_room_admins     reading_room_admins[]
  rekomendasi_judul       rekomendasi_judul[]
  staff                   staff[]
  students                students[]
  surat                   surat[]
  template_uploads        template_uploads[]
  thesis_titles           thesis_titles[]
}

model sessions {
  id         String   @id
  user_id    String
  token      String   @unique
  expires_at DateTime
  created_at DateTime @default(now())
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model staff {
  id         String  @id
  user_id    String  @unique
  nip        String? @unique
  department String?
  position   String
  phone      String?
  office     String?
  prodi_id   String?
  prodi      prodi?  @relation(fields: [prodi_id], references: [kode])
  users      users   @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model students {
  id                         String                       @id
  user_id                    String                       @unique
  nim                        String                       @unique
  major                      String?
  department                 String?
  semester                   Int
  academic_year              String
  phone                      String?
  address                    String?
  guardian                   Json?
  enroll_date                DateTime
  status                     StudentStatus                @default(active)
  gpa                        Float?
  academic_advisor_id        String?
  last_sync_at               DateTime?
  angkatan                   Int?
  email                      String?
  jenis_kelamin              String?
  lulus                      Boolean?
  masa_studi                 String?
  nik                        String?
  no_seri_ijazah             String?
  prodi_id                   String?
  semester_awal              String?
  tahun_akademik_lulus       String?
  tanggal_lahir              DateTime?
  tanggal_lulus              DateTime?
  tempat_lahir               String?
  academic_consultations     academic_consultations[]
  academic_events            academic_events[]
  book_borrowings            book_borrowings[]
  correspondence_requests    correspondence_requests[]
  exam_applications          exam_applications[]
  exam_student_requirements  exam_student_requirements[]
  grades                     grades[]
  kkp_applications           kkp_applications[]
  kkp_locations              kkp_locations[]
  kkp_requirements           kkp_requirements[]
  lab_assignment_submissions lab_assignment_submissions[]
  lab_registrations          lab_registrations[]
  letter_requests            letter_requests[]
  payments                   payments[]
  rekomendasi_judul          rekomendasi_judul[]
  lecturers                  lecturers?                   @relation(fields: [academic_advisor_id], references: [id])
  prodi                      prodi?                       @relation(fields: [prodi_id], references: [kode])
  users                      users                        @relation(fields: [user_id], references: [id], onDelete: Cascade)
  thesis_titles              thesis_titles[]
}

model system_configs {
  id          String   @id
  key         String   @unique
  value       String
  description String?
  category    String?
  updated_at  DateTime
}

model thesis_archives {
  id            String        @id
  thesis_id     String        @unique
  archive_date  DateTime      @default(now())
  location      String
  physical_id   String?
  digital_id    String?
  notes         String?
  thesis_titles thesis_titles @relation(fields: [thesis_id], references: [id], onDelete: Cascade)
}

model thesis_reviews {
  id            String        @id
  thesis_id     String
  reviewer_id   String
  action        String
  comments      String?
  review_date   DateTime      @default(now())
  thesis_titles thesis_titles @relation(fields: [thesis_id], references: [id], onDelete: Cascade)
}

model thesis_similarities {
  id                                                                  String        @id
  source_thesis_id                                                    String
  target_thesis_id                                                    String
  similarity_percentage                                               Float
  thesis_titles_thesis_similarities_source_thesis_id_to_thesis_titles thesis_titles @relation("thesis_similarities_source_thesis_id_to_thesis_titles", fields: [source_thesis_id], references: [id], onDelete: Cascade)
  thesis_titles_thesis_similarities_target_thesis_id_to_thesis_titles thesis_titles @relation("thesis_similarities_target_thesis_id_to_thesis_titles", fields: [target_thesis_id], references: [id], onDelete: Cascade)

  @@unique([source_thesis_id, target_thesis_id])
}

model thesis_titles {
  id                                                                        String                @id
  title                                                                     String
  abstract                                                                  String
  keywords                                                                  String[]
  submission_date                                                           DateTime              @default(now())
  status                                                                    ThesisStatus          @default(pending)
  year                                                                      Int
  similarity_score                                                          Float?
  digital_copy                                                              Boolean               @default(false)
  document_url                                                              String?
  external_link                                                             String?
  author_id                                                                 String
  supervisor_id                                                             String?
  department                                                                String?
  created_at                                                                DateTime              @default(now())
  updated_at                                                                DateTime
  prodi_id                                                                  String?
  thesis_archives                                                           thesis_archives?
  thesis_reviews                                                            thesis_reviews[]
  thesis_similarities_thesis_similarities_source_thesis_id_to_thesis_titles thesis_similarities[] @relation("thesis_similarities_source_thesis_id_to_thesis_titles")
  thesis_similarities_thesis_similarities_target_thesis_id_to_thesis_titles thesis_similarities[] @relation("thesis_similarities_target_thesis_id_to_thesis_titles")
  students                                                                  students              @relation(fields: [author_id], references: [id])
  prodi                                                                     prodi?                @relation(fields: [prodi_id], references: [kode])
  lecturers                                                                 lecturers?            @relation(fields: [supervisor_id], references: [id])
}

model users {
  id                       String                    @id
  username                 String                    @unique(map: "users_nidn_key")
  password                 String
  name                     String
  avatar                   String?
  role                     Role                      @default(mahasiswa)
  sub_role                 String?
  is_active                Boolean                   @default(true)
  created_at               DateTime                  @default(now())
  updated_at               DateTime
  accounts                 accounts[]
  audit_logs               audit_logs[]
  approved_correspondences correspondence_requests[] @relation("ApprovedBy")
  laboratory_admins        laboratory_admins[]
  lecturers                lecturers?
  reading_room_admins      reading_room_admins[]
  sessions                 sessions[]
  staff                    staff?
  students                 students?
  template_uploads         template_uploads[]
}

model template_uploads {
  id               String           @id @default(cuid())
  name             String
  description      String?
  file_url         String
  file_name        String
  file_size        Int
  file_type        String           @default("docx")
  category         String           @default("surat")
  prodi_id         String?
  is_global        Boolean          @default(false)
  is_active        Boolean          @default(true)
  detected_fields  Json?
  metadata         Json?
  variable_mapping Json?
  version          Int              @default(1)
  uploaded_by      String
  created_at       DateTime         @default(now())
  updated_at       DateTime         @updatedAt
  ketentuan_id     Int?
  ketentuan_surat  ketentuan_surat? @relation(fields: [ketentuan_id], references: [id])
  prodi            prodi?           @relation(fields: [prodi_id], references: [kode])
  uploader         users            @relation(fields: [uploaded_by], references: [id])

  @@index([prodi_id])
  @@index([uploaded_by])
  @@index([is_active])
  @@index([category])
  @@index([ketentuan_id])
}

model role_configurations {
  id          String   @id
  role        Role     @unique
  title       String
  subtitle    String
  icon_name   String
  description String?
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime
}

model laboratory_admins {
  id            String       @id
  user_id       String
  laboratory_id String
  prodi_id      String?
  assigned_at   DateTime     @default(now())
  assigned_by   String?
  is_primary    Boolean      @default(false)
  laboratories  laboratories @relation(fields: [laboratory_id], references: [id], onDelete: Cascade)
  prodi         prodi?       @relation(fields: [prodi_id], references: [kode])
  users         users        @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, laboratory_id])
  @@index([user_id])
  @@index([laboratory_id])
  @@index([prodi_id])
}

model curriculum {
  id                 String               @id
  prodi_id           String
  name               String
  academic_year      String
  semester           Int
  is_active          Boolean              @default(true)
  created_at         DateTime             @default(now())
  updated_at         DateTime             @default(now())
  prodi              prodi                @relation(fields: [prodi_id], references: [kode])
  curriculum_courses curriculum_courses[]

  @@index([prodi_id])
}

model curriculum_courses {
  id            String     @id
  curriculum_id String
  course_id     String
  is_mandatory  Boolean    @default(true)
  semester      Int
  created_at    DateTime   @default(now())
  courses       courses    @relation(fields: [course_id], references: [id], onDelete: Cascade)
  curriculum    curriculum @relation(fields: [curriculum_id], references: [id], onDelete: Cascade)

  @@unique([curriculum_id, course_id])
  @@index([curriculum_id])
  @@index([course_id])
}

model announcements {
  id           String               @id
  title        String
  content      String
  prodi_id     String?
  is_global    Boolean              @default(false)
  priority     AnnouncementPriority @default(normal)
  published    Boolean              @default(false)
  published_at DateTime?
  expires_at   DateTime?
  created_by   String
  created_at   DateTime             @default(now())
  updated_at   DateTime             @default(now())
  prodi        prodi?               @relation(fields: [prodi_id], references: [kode])

  @@index([prodi_id])
  @@index([published])
  @@index([created_at])
}

model classrooms {
  id           String   @id
  name         String
  building     String
  floor        Int?
  capacity     Int
  prodi_id     String?
  is_available Boolean  @default(true)
  facilities   String[]
  created_at   DateTime @default(now())
  updated_at   DateTime @default(now())
  prodi        prodi?   @relation(fields: [prodi_id], references: [kode])

  @@index([prodi_id])
  @@index([is_available])
}

model reading_room_admins {
  id          String   @id
  user_id     String
  prodi_id    String?
  assigned_at DateTime @default(now())
  assigned_by String?
  is_primary  Boolean  @default(false)
  prodi       prodi?   @relation(fields: [prodi_id], references: [kode])
  users       users    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, prodi_id])
  @@index([user_id])
  @@index([prodi_id])
}

model verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model rekomendasi_judul {
  id                String    @id @default(cuid())
  judul             String
  deskripsi         String
  bidang_keilmuan   String
  metodologi        String
  tingkat_kesulitan String
  estimasi_waktu    String
  prerequisites     String[]
  status            String    @default("Tersedia")
  dosen_id          String
  prodi_kode        String
  student_id        String?
  diambil_oleh      String?
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
  dosen             lecturers @relation(fields: [dosen_id], references: [id], onDelete: Cascade)
  prodi             prodi     @relation(fields: [prodi_kode], references: [kode], onDelete: Cascade)
  student           students? @relation(fields: [student_id], references: [id])

  @@index([dosen_id])
  @@index([prodi_kode])
  @@index([status])
  @@index([student_id])
}

model documents {
  id                 Int                  @id @default(autoincrement())
  type               String               @db.VarChar(50)
  prodi              String?              @db.VarChar(100)
  template_path      String?              @db.VarChar(255)
  description        String?
  version            String?              @default("1.0") @db.VarChar(10)
  is_active          Boolean              @default(true)
  max_filesize_mb    Int?                 @default(10)
  created_at         DateTime?            @default(now()) @db.Timestamp(6)
  updated_at         DateTime?            @updatedAt @db.Timestamp(6)
  document_fields    document_fields[]
  document_templates document_templates[]
  signed_documents   signed_documents[]

  @@unique([type, prodi])
}

model document_fields {
  id               Int        @id @default(autoincrement())
  document_id      Int?
  field_name       String     @db.VarChar(255)
  field_type       String     @db.VarChar(50)
  is_required      Boolean?   @default(true)
  default_value    String?
  validation_rules String?
  help_text        String?    @db.VarChar(500)
  display_order    Int?       @default(0)
  is_active        Boolean?   @default(true)
  created_at       DateTime?  @default(now()) @db.Timestamp(6)
  updated_at       DateTime?  @updatedAt @db.Timestamp(6)
  documents        documents? @relation(fields: [document_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model document_templates {
  id            Int       @id @default(autoincrement())
  document_id   Int
  template_name String    @db.VarChar(255)
  file_path     String    @db.VarChar(500)
  file_type     String    @default("docx") @db.VarChar(10)
  file_size     Int?
  checksum      String?   @db.VarChar(64)
  is_default    Boolean   @default(false)
  created_at    DateTime  @default(now()) @db.Timestamp(6)
  updated_at    DateTime  @updatedAt @db.Timestamp(6)
  document      documents @relation(fields: [document_id], references: [id], onDelete: Cascade)

  @@unique([document_id, template_name])
}

model document_categories {
  id          Int      @id @default(autoincrement())
  name        String   @unique @db.VarChar(100)
  description String?
  color_hex   String?  @default("#3B82F6") @db.VarChar(7)
  icon        String?  @db.VarChar(50)
  sort_order  Int?     @default(0)
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now()) @db.Timestamp(6)
  updated_at  DateTime @updatedAt @db.Timestamp(6)
}

model signers {
  id                   Int                   @id @default(autoincrement())
  name                 String                @db.VarChar(255)
  nbm                  String?               @unique @db.VarChar(50)
  email                String?               @unique @db.VarChar(255)
  phone                String?               @db.VarChar(20)
  role                 String                @db.VarChar(100)
  department           String?               @db.VarChar(100)
  prodi                String?               @db.VarChar(100)
  public_key           String
  private_key          String
  key_id               String                @unique @db.VarChar(32)
  signature_image_path String?               @db.VarChar(500)
  position_title       String?               @db.VarChar(255)
  is_active            Boolean               @default(true)
  last_signed_at       DateTime?             @db.Timestamp(6)
  created_at           DateTime              @default(now()) @db.Timestamp(6)
  updated_at           DateTime              @updatedAt @db.Timestamp(6)
  document_signatures  document_signatures[]
}

model signed_documents {
  id                        String                @id @default(uuid())
  document_type             String                @db.VarChar(50)
  prodi                     String                @db.VarChar(100)
  document_content          String
  document_hash             String                @db.VarChar(64)
  no_surat                  String?               @db.VarChar(100)
  file_path                 String?               @db.VarChar(500)
  file_size                 Int?
  qr_code_data              String
  qr_code_image             String?               @db.VarChar(500)
  total_signatures_required Int                   @default(3)
  total_signatures_received Int                   @default(0)
  is_complete               Boolean               @default(false)
  created_by                String?               @db.VarChar(255)
  approved_by               String?               @db.VarChar(255)
  priority_level            String?               @default("normal") @db.VarChar(20)
  expiry_date               DateTime?             @db.Timestamp(6)
  status                    String                @default("pending") @db.VarChar(50)
  status_notes              String?
  created_at                DateTime              @default(now()) @db.Timestamp(6)
  completed_at              DateTime?             @db.Timestamp(6)
  last_updated_at           DateTime              @updatedAt @db.Timestamp(6)
  document_id               Int?
  counter_id                Int?
  scope                     String?               @db.VarChar(20)
  document_history          document_history[]
  document_signatures       document_signatures[]
  counter                   document_counter?     @relation(fields: [counter_id], references: [id])
  documents                 documents?            @relation(fields: [document_id], references: [id])
  verification_logs         verification_logs[]
}

model document_signatures {
  id              Int              @id @default(autoincrement())
  signed_doc_id   String
  signer_id       Int
  signature_data  String
  signature_hash  String           @db.VarChar(64)
  signer_info     String
  algorithm       String           @default("EdDSA") @db.VarChar(50)
  timestamp       DateTime         @default(now()) @db.Timestamp(6)
  is_valid        Boolean          @default(true)
  signed_document signed_documents @relation(fields: [signed_doc_id], references: [id], onDelete: Cascade)
  signer          signers          @relation(fields: [signer_id], references: [id])

  @@unique([signed_doc_id, signer_id])
}

model verification_logs {
  id                   Int              @id @default(autoincrement())
  signed_doc_id        String
  verifier_ip          String?          @db.VarChar(45)
  verifier_agent       String?
  verification_method  String           @db.VarChar(50)
  verification_result  Boolean
  verification_details String?
  verified_at          DateTime         @default(now()) @db.Timestamp(6)
  signed_document      signed_documents @relation(fields: [signed_doc_id], references: [id], onDelete: Cascade)
}

model document_signature_config {
  id                       Int      @id @default(autoincrement())
  document_type            String   @unique @db.VarChar(50)
  required_signature_count Int      @default(1)
  required_roles           String[]
  description              String?
  is_active                Boolean  @default(true)
  created_at               DateTime @default(now()) @db.Timestamp(6)
  updated_at               DateTime @updatedAt @db.Timestamp(6)
}

model system_config {
  id           Int      @id @default(autoincrement())
  config_key   String   @unique @db.VarChar(100)
  config_value String
  description  String?
  updated_at   DateTime @updatedAt @db.Timestamp(6)
}

model document_history {
  id              Int              @id @default(autoincrement())
  signed_doc_id   String
  action          String           @db.VarChar(50)
  description     String
  performed_by    String?          @db.VarChar(255)
  ip_address      String?          @db.VarChar(45)
  user_agent      String?
  metadata        String?
  created_at      DateTime         @default(now()) @db.Timestamp(6)
  signed_document signed_documents @relation(fields: [signed_doc_id], references: [id], onDelete: Cascade)
}

model system_notifications {
  id             Int       @id @default(autoincrement())
  recipient      String    @db.VarChar(255)
  title          String    @db.VarChar(255)
  message        String
  type           String    @default("info") @db.VarChar(50)
  is_read        Boolean   @default(false)
  read_at        DateTime? @db.Timestamp(6)
  related_doc_id String?
  created_at     DateTime  @default(now()) @db.Timestamp(6)
}

model surat {
  id                 Int               @id @default(autoincrement())
  nomor_surat        String            @unique
  id_jenis_surat     Int?
  id_instansi        Int?
  id_kode_kategori   Int?
  id_masalah_surat   Int?
  bulan              String
  tahun_hijriah      String
  tahun_masehi       String
  perihal            String
  keterangan         String?
  id_prodi           String?
  kode_prodi         String?
  letter_request_id  String?
  signed_document_id String?
  scope              String            @default("fakultas")
  created_at         DateTime          @default(now())
  updated_at         DateTime          @updatedAt
  counter_id         Int?
  counter            document_counter? @relation(fields: [counter_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tujuan             tujuan?           @relation(fields: [id_instansi], references: [id], onDelete: NoAction, onUpdate: NoAction)
  jenis_surat        jenis_surat?      @relation(fields: [id_kode_kategori], references: [id], onDelete: NoAction, onUpdate: NoAction)
  masalah_surat      masalah_surat?    @relation(fields: [id_masalah_surat], references: [id], onDelete: NoAction, onUpdate: NoAction)
  prodi              prodi?            @relation(fields: [id_prodi], references: [kode], onDelete: NoAction, onUpdate: NoAction)
}

model document_counter {
  id               Int                @id @default(autoincrement())
  counter          Int                @default(0)
  tahun            String             @default("2025")
  prodi_id         String             @default("")
  scope            String             @default("fakultas")
  ketentuan        ketentuan_surat[]
  signed_documents signed_documents[]
  surat            surat[]

  @@unique([tahun, prodi_id, scope])
  @@index([scope, prodi_id, tahun])
  @@map("count_surat")
}

model masalah_surat {
  id        Int               @id @default(autoincrement())
  masalah   String
  kode      String            @unique
  ketentuan ketentuan_surat[]
  surat     surat[]
}

model tujuan {
  id        Int               @id @default(autoincrement())
  nama      String
  kode      String
  id_jenis  Int               @db.SmallInt
  ketentuan ketentuan_surat[]
  surat     surat[]
  jenis     jenis_surat       @relation(fields: [id_jenis], references: [id])
}

model jenis_surat {
  id           Int               @id @default(autoincrement())
  nama         String
  kode         String            @unique
  ketentuan    ketentuan_surat[]
  letter_types letter_types[]    @relation("LetterTypeJenisSurat")
  surat        surat[]
  tujuan       tujuan[]
}

model ketentuan_surat {
  id               Int                @id @default(autoincrement())
  id_tujuan        Int
  id_masalah       Int
  kode             String
  nama             String             @unique
  id_jenis         Int
  id_count         Int?
  format_template  String?
  description      String?
  is_global        Boolean            @default(true)
  prodi_id         String?
  counter          document_counter?  @relation(fields: [id_count], references: [id])
  jenis            jenis_surat        @relation(fields: [id_jenis], references: [id])
  masalah          masalah_surat      @relation(fields: [id_masalah], references: [id])
  tujuan           tujuan             @relation(fields: [id_tujuan], references: [id])
  prodi            prodi?             @relation(fields: [prodi_id], references: [kode])
  template_uploads template_uploads[]

  @@unique([id_tujuan, id_masalah, id_jenis])
}

model laboratory_certificates {
  id                         String    @id @default(cuid())
  verification_id            String    @unique
  certificate_title          String
  participant_name           String
  program_name               String
  subtitle                   String?
  issue_date                 DateTime  @default(now())
  
  // Performance & Analytics Fields (Optional - akan diisi kemudian)
  meetings                   Int?
  total_score                Int?
  materials                  Int?
  attendance_rate            Int?
  assignment_completion      Int?
  participation_score        Int?
  overall_grade              String?
  learning_hours             Int?
  weekly_data                Int[]
  learning_velocity          Int?
  collaboration_score        Int?
  problem_solving_efficiency Int?
  competencies               Json?
  technologies               String[]
  
  // QR Code & PDF Fields
  qr_code_url                String?
  pdf_password               String?
  pdf_url                    String?
  qr_signature_url           String?
  
  // Digital Signature Fields
  signature                  String?
  signature_data             Json?
  signed_at                  DateTime?
  signed_by                  String?
  
  // Metadata
  prodi_id                   String
  created_by                 String?
  verification_count         Int       @default(0)
  created_at                 DateTime  @default(now())
  updated_at                 DateTime  @updatedAt
  
  prodi                      prodi     @relation(fields: [prodi_id], references: [kode], onDelete: Cascade)

  @@index([prodi_id])
  @@index([verification_id])
  @@index([created_by])
  @@index([created_at])
}

enum ApprovalRole {
  staff_tu
  prodi
  dekan
  none
}

enum ApprovalStatus {
  pending
  approved
  rejected
}

enum AnnouncementPriority {
  low
  normal
  high
  urgent
}

enum BookStatus {
  available
  borrowed
  reserved
  maintenance
}

enum BorrowingStatus {
  active
  returned
  overdue
  lost
}

enum BudgetStatus {
  active
  inactive
  closed
}

enum DocumentStatus {
  pending
  verified
  rejected
}

enum EventStatus {
  confirmed
  pending
  cancelled
  completed
}

enum EventType {
  exam
  class
  lab
  consultation
  seminar
  workshop
  deadline
  organization
}

enum ExamDocumentType {
  payment_proof
  transcript
  proposal
  supervisor_approval
  pembayaran_bpp
  biaya_komprehensif
  surat_sk_pembimbing
  surat_penyelesaian_kkp
  transkrip_nilai_145
  praktikum_ilmu_falaq
  surat_publikasi_produk
  bukti_publish_produk
  surat_baca_alquran
  sertifikat_dad
  uji_plagiat_skripsi
  kartu_kontrol_seminar
  persetujuan_pembimbing
  biaya_ujian_seminar
  transkrip_nilai_hasil
  sertifikat_praktikum
  uji_plagiat_hasil
  persetujuan_pembimbing_hasil
  skripsi_6_rangkap
  pembayaran_ujian
  biaya_tambahan_wd2
  pembayaran_wisuda_perpustakaan
  uji_plagiat_tutup
  persetujuan_pembimbing_tutup
  skripsi_1_rangkap
  berkas_loa_jurnal
  transkrip_nilai_150
  berkas_persyaratan_yudisium
  other
}

enum ExamStatus {
  applicant
  pending
  scheduled
  completed
  passed
  failed
  cancelled
}

enum ExamType {
  proposal
  result
  final
  closing
  midterm
  other
}

enum ExpenseStatus {
  pending
  approved
  rejected
  paid
}

enum KkpDocumentType {
  application_letter
  proposal
  transcript
  acceptance_letter
  supervisor_letter
  report
  evaluation
  payment_proof_kkp_plus
  transcript_125_sks
  competency_certificate
  practicum_control_card
  falaq_practicum
  quran_reading_certificate
  academic_advisor_card
  dad_certificate
}

enum KkpRequirementType {
  payment_proof_kkp_plus
  transcript_125_sks
  competency_certificate
  practicum_control_card
  falaq_practicum
  quran_reading_certificate
  academic_advisor_card
  dad_certificate
}

enum KkpStatus {
  pending
  approved
  rejected
  in_progress
  completed
}

enum LabRegistrationStatus {
  pending
  approved
  rejected
  completed
  dropped
}

enum LabSessionStatus {
  scheduled
  ongoing
  completed
  cancelled
}

enum LabStatus {
  active
  inactive
  maintenance
}

enum LetterStatus {
  submitted
  in_review
  approved
  completed
  rejected
}

enum NotificationType {
  info
  warning
  error
  success
}

enum PaymentCategory {
  laboratory
  exam
  kkp
  tuition
  other
}

enum PaymentStatus {
  pending
  completed
  failed
  refunded
}

enum Role {
  mahasiswa
  dosen
  staff_tu
  prodi
  dekan
  admin
  laboratory_admin
  reading_room_admin
  admin_umum
  admin_keuangan
  gkm
  kepala_tata_usaha
}

enum StudentStatus {
  active
  inactive
  graduated
  dropped_out
  suspended
}

enum ThesisStatus {
  pending
  approved
  rejected
  archived
}
